---
title: "R Notebook"
output: html_notebook
---


load data in R
```{r}
pasAnno <- read.table(file = '/Users/wangke/Desktop/final/seq.tsv', sep = '\t', header = TRUE) 
```
```{r}
pasCts<-read.csv("/Users/wangke/Desktop/final/donor1.csv",row.names = 1)
```


Delete extra columns
```{r}
library(readxl)
pasAnno1<-subset(pasAnno,select = c(1,8,10))
pasCts1<-subset(pasCts,select = c(1,5,8,9))
```


Change data format (length data to width data)
```{r}
require(tidyverse)
#data <- data <- iris[c(4,5)]
dat <-  pasAnno1 %>% 
  group_by(icgc_donor_id) %>%
  mutate(index = row_number()) %>%
  pivot_wider(names_from = icgc_donor_id, 
              values_from = raw_read_count) %>%
  select(-index)
pasAnno2<-dat
```


Delete all NULL rows
```{r}
pasAnno3<- filter(pasAnno2, pasAnno2$DO51966 !='NULL') 
```


save width data
```{r}
write.csv(pasAnno3, file = "/Users/wangke/Desktop/rawdata.csv", row.names = F, quote = F, na="0")
```


Delete all zero rows
```{r}
getwd()
mycounts<-read.csv("/Users/wangke/Desktop/final/finaldata.csv",row.names = 1)
mycounts_1 = mycounts[rowSums(mycounts) !=0,]
#dim(mycounts)
#im(mycounts_1)
```


Check the correspondence between the two files (Prepare for DESeq2)
```{r}
colnames(mycounts_1) == pasCts$icgc_donor_id
```


Install DESeq2
```{r}
if (!requireNamespace("BiocManager", quietly = TRUE))
    install.packages("BiocManager")

BiocManager::install("DESeq2")
```


load data in DESeq2 and calculate
```{r}
library("DESeq2")
dds<-DESeqDataSetFromMatrix(countData = mycounts_1,
                            colData = pasCts,
                            design = ~donor_type)
dds<-DESeq(dds)
res<-results(dds)

```


check data in res
```{r}
head(res)
class(res)
```


store res in a frame
```{r}
res1<-data.frame(res)
#head(res1)
#class(res1)
```


Calculation data with DESeq2
```{r}
library(dplyr)
res2<-mutate(res1,group=case_when(log2FoldChange>=2&padj<=0.05 ~ "UP",log2FoldChange<=-2&padj<=0.05~"DOWN"))
```


check the number of UP and DOWN
```{r}
table(res2$group)
```


store the end of the calculation to next step
```{r}
write.csv(res2,file="/Users/wangke/Desktop/final/drawdata.csv",quote = F)
```


